<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Ansys10多机并行计算测试</title>
    <url>/2020/02/20/ansys10%E5%A4%9A%E6%9C%BA%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97%E6%B5%8B%E8%AF%95/</url>
    <content><![CDATA[<h3 id="batch模式"><a href="#batch模式" class="headerlink" title="batch模式"></a>batch模式</h3><p>ANSYS的批处理是区别于GUI界面执行有限元分析过程的方式，通过批处理执行分析过程不用显式模型的相关情况，只会在后台运行，因而避免了用于可视化显式的相关资源的应用，速度相对来说比在GUI界面完成要快。而且批处理更大的好处是可以通过第三方软件或者编写的程序自动执行批处理过程，在二次开发中用的比较多。ansys10的并行计算只能在batch模式下进行。须建立一个后缀名为bat的批处理文件，然后通个这个批处理文件运行ansys并计算。如：parallel.bat。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="string">"C:\Program Files\Ansys Inc\v100\ANSYS\bin\Intel\ansys100.exe"</span>  -p ANSYS -dir <span class="string">"D:\answork"</span> -j <span class="string">"file"</span> -pp -s <span class="built_in">read</span> -mpi MPICH -dis -machines apple:2:lee:1 -l en-us -b -i <span class="string">"D:\answork\runtime.txt"</span> -o <span class="string">"D:\answork\runtime.out"</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>其内容可由laucher中的tools/dispaly command line 获得。先在lauch里选好“parallel performance for ansys”。在customization中的additional parameters 后填写 -i”g:\test\runtime.txt”-o “ g:\test\runtime.out””,”g:\test\runtime.txt”是你的命令。流文件，”g:\test\runtime.out”是运行后生成的文件。在sover setup里选好”run distributed ansys”，MPI type选”MPICH”。下面的框框里选“use multiple hosts”,并加好hosts,这时点tools/display commmand line,将command line里的字全部copy到一个bat文件中。注意一定要把其中“…dis -mpi mpich…”改为“…-mpi MPICH -dis…”否则一闪而过，不会进行计算，前面说的不能以ＧＵＩ方式运行“run distributed ansys”，就是这种一闪而过的症状。</p>
<h3 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h3><p>runtime.txt</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/prep7</span><br><span class="line">/title,parallel performance <span class="keyword">for</span> ansys</span><br><span class="line">antype,static</span><br><span class="line">L=8</span><br><span class="line">B=0.5</span><br><span class="line">H=0.5</span><br><span class="line">LE=2.5E-2</span><br><span class="line">E=200E9</span><br><span class="line">V=0.3</span><br><span class="line">et,1,solid45</span><br><span class="line">mp,ex,1,e</span><br><span class="line">mp,nuxy,1,v</span><br><span class="line">mp,dens,1,7850</span><br><span class="line">block,0,L,0,B,0,H</span><br><span class="line">lesize,all,LE</span><br><span class="line">vmes,all</span><br><span class="line">nsel,s,loc,x,0</span><br><span class="line">nsel,r,loc,z,0</span><br><span class="line">nsel,r,loc,y,0</span><br><span class="line">d,all,all,0</span><br><span class="line">allsel,all</span><br><span class="line">nsel,s,loc,x,0</span><br><span class="line">nsel,r,loc,z,H</span><br><span class="line">nsel,r,lco,y,0</span><br><span class="line">d,all,all,0</span><br><span class="line">allsel,all</span><br><span class="line">nsel,s,loc,x,l</span><br><span class="line">nsel,r,loc,z,0</span><br><span class="line">nsel,r,loc,y,0</span><br><span class="line">d,all,all,0</span><br><span class="line">allsel,all</span><br><span class="line">nsel,s,loc,x,L</span><br><span class="line">nsel,r,loc,z,H</span><br><span class="line">nsel,r,loc,y,0</span><br><span class="line">d,all,all,0</span><br><span class="line">allsel,all</span><br><span class="line"></span><br><span class="line">/solu</span><br><span class="line">eqslv,dpcg</span><br><span class="line">dsopt,script,auto</span><br><span class="line">dsproc,3</span><br></pre></td></tr></table></figure>
<h3 id="计算效率对比"><a href="#计算效率对比" class="headerlink" title="计算效率对比"></a>计算效率对比</h3><p>根据计算结果分析，如模型不复杂，单机就已经很快，因为通信也需要花掉很多时间。计算时要关闭超线程。据说smp并行模式8-16核并行效率较高，我的机器只有双核这方面没有测试。此外mpp并行效率还和网格区域分解策略有关，具体要看模型。</p>
<pre><code>CP time = CPU 计算总共时间 (不含前处理及矩阵生成), 若为多核心则要除以核心数
Elapsed time = 分析总共时间 , 等於分析起始点到结束时间 </code></pre><p>调整求解器，以适应多核或分布式计算。</p>
<pre><code>直接求解器（Direct）：Sparse
迭代求解器（Iterative）：PCG、AMG
分布式内存求解器（Distributed Memory）：Dsparse、DPCG、DDS</code></pre><h4 id="0-单机双核"><a href="#0-单机双核" class="headerlink" title="0.单机双核"></a>0.单机双核</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">***** ROUTINE COMPLETED *****  CP =        12.324</span><br></pre></td></tr></table></figure>

<h4 id="1-并行计算"><a href="#1-并行计算" class="headerlink" title="1.并行计算"></a>1.并行计算</h4><h5 id="1-1双核１００M网线"><a href="#1-1双核１００M网线" class="headerlink" title="1.1双核１００Ｍ网线"></a>1.1双核１００Ｍ网线</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">FINISH SOLUTION PROCESSING</span><br><span class="line"></span><br><span class="line"> ***** ROUTINE COMPLETED *****  CP =        24.477</span><br><span class="line"></span><br><span class="line"> ***** END OF INPUT ENCOUNTERED *****</span><br><span class="line"></span><br><span class="line"> PURGE ALL SOLUTION AND POST DATA</span><br><span class="line"> SAVE ALL MODEL DATA</span><br><span class="line"></span><br><span class="line"> ALL CURRENT ANSYS DATA WRITTEN TO FILE NAME= file0.db</span><br><span class="line">  FOR POSSIBLE RESUME FROM THIS POINT</span><br><span class="line"></span><br><span class="line"> NUMBER OF WARNING MESSAGES ENCOUNTERED=          1</span><br><span class="line"> NUMBER OF ERROR   MESSAGES ENCOUNTERED=          0</span><br><span class="line"></span><br><span class="line"> *---------------------------------------------------------------------------*</span><br><span class="line"> |                                                                           |</span><br><span class="line"> |                       DISTRIBUTED ANSYS RUN COMPLETED                     |</span><br><span class="line"> |                                                                           |</span><br><span class="line"> |---------------------------------------------------------------------------|</span><br><span class="line"> |                                                                           |</span><br><span class="line"> |            Release 10.0           UP20050718         INTEL NT             |</span><br><span class="line"> |                                                                           |</span><br><span class="line"> |---------------------------------------------------------------------------|</span><br><span class="line"> |                                                                           |</span><br><span class="line"> |   Maximum Scratch Memory Used       =    56089960 Words      213.966 MB   |</span><br><span class="line"> |                                                                           |</span><br><span class="line"> |---------------------------------------------------------------------------|</span><br><span class="line"> |                                                                           |</span><br><span class="line"> |        CP Time      (sec) =         24.851       Time  =  12:07:57        |</span><br><span class="line"> |        Elapsed Time (sec) =         37.000       Date  =  07/02/2019      |</span><br><span class="line"> |                                                                           |</span><br><span class="line"> *---------------------------------------------------------------------------*</span><br></pre></td></tr></table></figure>
<h5 id="1-2单核无线网络４８M"><a href="#1-2单核无线网络４８M" class="headerlink" title="1.2单核无线网络４８Ｍ"></a>1.2单核无线网络４８Ｍ</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">*** ANSYS BINARY FILE STATISTICS</span><br><span class="line">  BUFFER SIZE USED= 16384</span><br><span class="line">      220.750 MB WRITTEN ON ELEMENT SAVED DATA FILE: file0.esav</span><br><span class="line">      124.125 MB WRITTEN ON RESULTS FILE: file0.rst</span><br><span class="line"></span><br><span class="line"> FINISH SOLUTION PROCESSING</span><br><span class="line"></span><br><span class="line"> ***** ROUTINE COMPLETED *****  CP =       157.109</span><br><span class="line"></span><br><span class="line"> ***** END OF INPUT ENCOUNTERED *****</span><br><span class="line"></span><br><span class="line"> PURGE ALL SOLUTION AND POST DATA</span><br><span class="line"> SAVE ALL MODEL DATA</span><br><span class="line"></span><br><span class="line"> ALL CURRENT ANSYS DATA WRITTEN TO FILE NAME= file0.db</span><br><span class="line">  FOR POSSIBLE RESUME FROM THIS POINT</span><br><span class="line"></span><br><span class="line"> NUMBER OF WARNING MESSAGES ENCOUNTERED=          1</span><br><span class="line"> NUMBER OF ERROR   MESSAGES ENCOUNTERED=          0</span><br><span class="line"></span><br><span class="line"> *---------------------------------------------------------------------------*</span><br><span class="line"> |                                                                           |</span><br><span class="line"> |                       DISTRIBUTED ANSYS RUN COMPLETED                     |</span><br><span class="line"> |                                                                           |</span><br><span class="line"> |---------------------------------------------------------------------------|</span><br><span class="line"> |                                                                           |</span><br><span class="line"> |            Release 10.0           UP20050718         INTEL NT             |</span><br><span class="line"> |                                                                           |</span><br><span class="line"> |---------------------------------------------------------------------------|</span><br><span class="line"> |                                                                           |</span><br><span class="line"> |   Maximum Scratch Memory Used       =    47632432 Words      181.703 MB   |</span><br><span class="line"> |                                                                           |</span><br><span class="line"> |---------------------------------------------------------------------------|</span><br><span class="line"> |                                                                           |</span><br><span class="line"> |        CP Time      (sec) =        157.545       Time  =  10:16:57        |</span><br><span class="line"> |        Elapsed Time (sec) =        217.000       Date  =  07/02/2019      |</span><br><span class="line"> |                                                                           |</span><br><span class="line"> *---------------------------------------------------------------------------*</span><br></pre></td></tr></table></figure>
<h5 id="1-3双核无线网络48M"><a href="#1-3双核无线网络48M" class="headerlink" title="1.3双核无线网络48M"></a>1.3双核无线网络48M</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">*** ANSYS BINARY FILE STATISTICS</span><br><span class="line"> BUFFER SIZE USED= 16384</span><br><span class="line">     147.250 MB WRITTEN ON ELEMENT SAVED DATA FILE: file0.esav</span><br><span class="line">      82.812 MB WRITTEN ON RESULTS FILE: file0.rst</span><br><span class="line"></span><br><span class="line">FINISH SOLUTION PROCESSING</span><br><span class="line"></span><br><span class="line">***** ROUTINE COMPLETED *****  CP =       111.229</span><br><span class="line"></span><br><span class="line">***** END OF INPUT ENCOUNTERED *****</span><br><span class="line"></span><br><span class="line">PURGE ALL SOLUTION AND POST DATA</span><br><span class="line">SAVE ALL MODEL DATA</span><br><span class="line"></span><br><span class="line">ALL CURRENT ANSYS DATA WRITTEN TO FILE NAME= file0.db</span><br><span class="line"> FOR POSSIBLE RESUME FROM THIS POINT</span><br><span class="line"></span><br><span class="line">NUMBER OF WARNING MESSAGES ENCOUNTERED=          1</span><br><span class="line">NUMBER OF ERROR   MESSAGES ENCOUNTERED=          0</span><br><span class="line"></span><br><span class="line">*---------------------------------------------------------------------------*</span><br><span class="line">|                                                                           |</span><br><span class="line">|                       DISTRIBUTED ANSYS RUN COMPLETED                     |</span><br><span class="line">|                                                                           |</span><br><span class="line">|---------------------------------------------------------------------------|</span><br><span class="line">|                                                                           |</span><br><span class="line">|            Release 10.0           UP20050718         INTEL NT             |</span><br><span class="line">|                                                                           |</span><br><span class="line">|---------------------------------------------------------------------------|</span><br><span class="line">|                                                                           |</span><br><span class="line">|   Maximum Scratch Memory Used       =    56089960 Words      213.966 MB   |</span><br><span class="line">|                                                                           |</span><br><span class="line">|---------------------------------------------------------------------------|</span><br><span class="line">|                                                                           |</span><br><span class="line">|        CP Time      (sec) =        111.666       Time  =  10:48:08        |</span><br><span class="line">|        Elapsed Time (sec) =        141.000       Date  =  07/02/2019      |</span><br><span class="line">|                                                                           |</span><br><span class="line">*---------------------------------------------------------------------------*</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>CAE</category>
      </categories>
      <tags>
        <tag>ansys</tag>
        <tag>并行计算</tag>
      </tags>
  </entry>
</search>
